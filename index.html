<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ã‚¹ãƒãƒ›ãƒœãƒ¼ãƒ«è»¢ãŒã—ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: sans-serif;
            background: #222;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* ä¸Šéƒ¨ã«å¯„ã›ã‚‹ */
            height: 100vh;
            margin: 0;
            padding-top: 20px;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        #gameCanvas {
            border: 2px solid #4285f4;
            background-color: #333;
            box-shadow: 0 0 15px rgba(66, 133, 244, 0.5);
            margin-bottom: 20px;
        }

        #message, #score {
            margin-top: 10px;
            font-size: 1.2em;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:active {
            background-color: #357ae8;
        }

        /* ç”»é¢ã‚’ç¸¦å‘ãã«å›ºå®šã™ã‚‹CSSï¼ˆä»»æ„ï¼‰ */
        @media screen and (orientation: landscape) {
            body::before {
                content: "ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’ç¸¦å‘ãã«ã—ã¦ãƒ—ãƒ¬ã‚¤ã—ã¦ãã ã•ã„ã€‚";
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5em;
                z-index: 1000;
            }
        }
    </style>
</head>
<body>

    <h1>ğŸ“± ãƒœãƒ¼ãƒ«è»¢ãŒã—ã‚²ãƒ¼ãƒ </h1>
    <p id="message">ã‚»ãƒ³ã‚µãƒ¼ã‚’æœ‰åŠ¹ã«ã—ã¦ã€ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦ãƒœãƒ¼ãƒ«ã‚’æ“ä½œï¼</p>
    <p id="score">ã‚¹ã‚³ã‚¢: 0</p>

    <canvas id="gameCanvas" width="300" height="400"></canvas>
    
    <button id="enable-btn">ã‚»ãƒ³ã‚µãƒ¼ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const enableBtn = document.getElementById('enable-btn');
        const messageDisplay = document.getElementById('message');
        const scoreDisplay = document.getElementById('score');

        // --- ã‚²ãƒ¼ãƒ å®šæ•° ---
        const BALL_RADIUS = 10;
        const GRAVITY_MULTIPLIER = 0.5; // å‚¾ãã«å¯¾ã™ã‚‹æ„Ÿåº¦
        const FRICTION = 0.98; // æ‘©æ“¦ã«ã‚ˆã‚‹æ¸›è¡°
        const WALL_BOUNCE = 0.7; // å£ã®åç™ºä¿‚æ•°

        // --- ã‚²ãƒ¼ãƒ å¤‰æ•° ---
        let ballX = canvas.width / 2;
        let ballY = canvas.height / 2;
        let velocityX = 0;
        let velocityY = 0;
        let accelerationX = 0;
        let accelerationY = 0;
        let gameLoopId;
        let score = 0;
        let obstacle = createRandomObstacle(); // éšœå®³ç‰©
        let target = createRandomTarget(); // ã‚´ãƒ¼ãƒ«

        // --- Device Orientation ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ© ---
        function handleOrientation(event) {
            // beta: Xè»¸ï¼ˆå‰å¾Œï¼‰ã€gamma: Yè»¸ï¼ˆå·¦å³ï¼‰ã‚’ä½¿ç”¨
            const beta = event.beta || 0; 
            const gamma = event.gamma || 0;

            // å‚¾ãã‚’åŠ é€Ÿåº¦ã«å¤‰æ›
            // beta (å‰å¾Œå‚¾ã) ã¯ Yè»¸ã®å‹•ã
            // gamma (å·¦å³å‚¾ã) ã¯ Xè»¸ã®å‹•ã
            // ä¿‚æ•°ã‚’æ›ã‘ã¦æ„Ÿåº¦ã‚’èª¿æ•´
            accelerationX = gamma * GRAVITY_MULTIPLIER;
            accelerationY = beta * GRAVITY_MULTIPLIER; 

            // ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚’ç¸¦å‘ãã«æŒã¤ã“ã¨ã‚’å‰æã¨ã™ã‚‹
            // ç”»é¢ã‚’å¹³ã‚‰ã«ç½®ã„ãŸçŠ¶æ…‹ï¼ˆbeta=0, gamma=0ï¼‰ãŒä¸­å¿ƒ
        }

        // --- ã‚²ãƒ¼ãƒ è¦ç´ ã®åˆæœŸåŒ–/ç”Ÿæˆ ---

        // éšœå®³ç‰©ã‚’ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã«ç”Ÿæˆ
        function createRandomObstacle() {
            const size = 30;
            const padding = 50;
            return {
                x: Math.random() * (canvas.width - size - padding * 2) + padding,
                y: Math.random() * (canvas.height - size - padding * 2) + padding,
                width: size,
                height: 10,
                color: 'red'
            };
        }

        // ã‚´ãƒ¼ãƒ«ã‚’ãƒ©ãƒ³ãƒ€ãƒ ãªä½ç½®ã«ç”Ÿæˆ
        function createRandomTarget() {
            const radius = 15;
            const padding = 50;
             let x, y;
             do {
                x = Math.random() * (canvas.width - radius * 2 - padding * 2) + padding + radius;
                y = Math.random() * (canvas.height - radius * 2 - padding * 2) + padding + radius;
             } while (checkCollision(x, y, radius, obstacle)); // éšœå®³ç‰©ã¨é‡ãªã‚‰ãªã„ã‚ˆã†ã«
            
            return {
                x: x,
                y: y,
                radius: radius,
                color: 'green'
            };
        }

        // è¡çªåˆ¤å®šãƒ˜ãƒ«ãƒ‘ãƒ¼ (ãƒœãƒ¼ãƒ«ã¨å››è§’å½¢)
        function checkCollision(ballX, ballY, ballR, rect) {
             const closestX = Math.max(rect.x, Math.min(ballX, rect.x + rect.width));
             const closestY = Math.max(rect.y, Math.min(ballY, rect.y + rect.height));
             const distanceX = ballX - closestX;
             const distanceY = ballY - closestY;
             return (distanceX * distanceX + distanceY * distanceY) < (ballR * ballR);
        }

        // --- æç”»é–¢æ•° ---

        // ãƒœãƒ¼ãƒ«ã®æç”»
        function drawBall() {
            ctx.beginPath();
            ctx.arc(ballX, ballY, BALL_RADIUS, 0, Math.PI * 2);
            ctx.fillStyle = '#f9e710';
            ctx.fill();
            ctx.closePath();
        }

        // éšœå®³ç‰©ï¼ˆå››è§’å½¢ï¼‰ã®æç”»
        function drawObstacle() {
            ctx.fillStyle = obstacle.color;
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        }

        // ã‚´ãƒ¼ãƒ«ï¼ˆå††ï¼‰ã®æç”»
        function drawTarget() {
            ctx.beginPath();
            ctx.arc(target.x, target.y, target.radius, 0, Math.PI * 2);
            ctx.fillStyle = target.color;
            ctx.fill();
            ctx.closePath();
        }

        // --- ãƒ¡ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ---
        function updateGame() {
            // é€Ÿåº¦ã«åŠ é€Ÿåº¦ã‚’é©ç”¨
            velocityX += accelerationX * 0.05; // èª¿æ•´ç”¨ã®ä¿‚æ•°
            velocityY += accelerationY * 0.05; // èª¿æ•´ç”¨ã®ä¿‚æ•°

            // æ‘©æ“¦ã«ã‚ˆã‚‹æ¸›è¡°
            velocityX *= FRICTION;
            velocityY *= FRICTION;

            // ä½ç½®ã®æ›´æ–°
            ballX += velocityX;
            ballY += velocityY;

            // 1. å£ã¨ã®è¡çªåˆ¤å®šã¨åç™º
            
            // Xè»¸æ–¹å‘ï¼ˆå·¦å³ã®å£ï¼‰
            if (ballX + BALL_RADIUS > canvas.width || ballX - BALL_RADIUS < 0) {
                // ãƒœãƒ¼ãƒ«ã‚’å£ã®å†…å´ã«æŠ¼ã—æˆ»ã™
                if (ballX + BALL_RADIUS > canvas.width) {
                    ballX = canvas.width - BALL_RADIUS;
                } else if (ballX - BALL_RADIUS < 0) {
                    ballX = BALL_RADIUS;
                }
                // é€Ÿåº¦ã‚’åè»¢ã•ã›ã€åç™ºä¿‚æ•°ã‚’æ›ã‘ã‚‹
                velocityX = -velocityX * WALL_BOUNCE;
            }

            // Yè»¸æ–¹å‘ï¼ˆä¸Šä¸‹ã®å£ï¼‰
            if (ballY + BALL_RADIUS > canvas.height || ballY - BALL_RADIUS < 0) {
                 // ãƒœãƒ¼ãƒ«ã‚’å£ã®å†…å´ã«æŠ¼ã—æˆ»ã™
                if (ballY + BALL_RADIUS > canvas.height) {
                    ballY = canvas.height - BALL_RADIUS;
                } else if (ballY - BALL_RADIUS < 0) {
                    ballY = BALL_RADIUS;
                }
                // é€Ÿåº¦ã‚’åè»¢ã•ã›ã€åç™ºä¿‚æ•°ã‚’æ›ã‘ã‚‹
                velocityY = -velocityY * WALL_BOUNCE;
            }


            // 2. éšœå®³ç‰©ã¨ã®è¡çªåˆ¤å®šï¼ˆå˜ç´”ãªè¡çªã§å‡¦ç†ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
            if (checkCollision(ballX, ballY, BALL_RADIUS, obstacle)) {
                // è¡çªã—ãŸã‚‰ã€ä¸€æ—¦é€Ÿåº¦ã‚’ã‚¼ãƒ­ã«ã—ã¦å‹•ãã‚’æ­¢ã‚ã‚‹ï¼ˆã‚·ãƒ³ãƒ—ãƒ«åŒ–ï¼‰
                // ã‚ˆã‚Šé«˜åº¦ãªç‰©ç†æ¼”ç®—ãŒå¿…è¦ãªå ´åˆã¯ã€è¡çªæ™‚ã®æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã«åŸºã¥ã„ãŸåå°„å‡¦ç†ãŒå¿…è¦
                velocityX = 0;
                velocityY = 0;
                messageDisplay.textContent = 'â›” éšœå®³ç‰©ã«ã¶ã¤ã‹ã‚Šã¾ã—ãŸï¼';
            }


            // 3. ã‚´ãƒ¼ãƒ«ã¨ã®è¡çªåˆ¤å®š
            const targetDistance = Math.sqrt(
                (ballX - target.x) ** 2 + (ballY - target.y) ** 2
            );
            if (targetDistance < BALL_RADIUS + target.radius) {
                // ã‚´ãƒ¼ãƒ«ï¼
                score += 1;
                scoreDisplay.textContent = `ã‚¹ã‚³ã‚¢: ${score}`;
                messageDisplay.textContent = 'ğŸ‰ ã‚´ãƒ¼ãƒ«ï¼æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¸...';
                
                // æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®åˆæœŸåŒ–
                ballX = canvas.width / 2;
                ballY = canvas.height / 2;
                velocityX = 0;
                velocityY = 0;
                obstacle = createRandomObstacle();
                target = createRandomTarget();
            }

            // ç”»é¢ã®å†æç”»
            ctx.clearRect(0, 0, canvas.width, canvas.height); // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªã‚¢
            drawObstacle();
            drawTarget();
            drawBall();
            
            gameLoopId = requestAnimationFrame(updateGame);
        }

        // --- ã‚»ãƒ³ã‚µãƒ¼æœ‰åŠ¹åŒ–ã¨ã‚²ãƒ¼ãƒ é–‹å§‹ ---
        function enableSensor() {
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOSå¯¾å¿œ: æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
                DeviceOrientationEvent.requestPermission().then(state => {
                    if (state === 'granted') {
                        startListening();
                    } else {
                        alert('ã‚»ãƒ³ã‚µãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã€‚');
                    }
                }).catch(error => {
                     alert('ã‚»ãƒ³ã‚µãƒ¼ã‚¢ã‚¯ã‚»ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                });
            } else {
                // Androidãªã©: ãã®ã¾ã¾ãƒªã‚¹ãƒŠãƒ¼ã‚’ç™»éŒ²
                startListening();
            }
        }
        
        function startListening() {
            window.addEventListener('deviceorientation', handleOrientation);
            messageDisplay.textContent = 'ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ã‚¹ãƒãƒ›ã‚’å‚¾ã‘ã¦ãƒœãƒ¼ãƒ«ã‚’å‹•ã‹ãã†ï¼';
            enableBtn.style.display = 'none'; // ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
            if (!gameLoopId) {
                // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—é–‹å§‹
                gameLoopId = requestAnimationFrame(updateGame);
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            // ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            enableBtn.addEventListener('click', enableSensor);

            // åˆå›æç”»
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawObstacle();
            drawTarget();
            drawBall();
        });

    </script>
</body>
</html>
